
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音樂播放圖片輪播系統</title>
    <style>
        /* 整體背景與字體 */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); /* 深色漸變背景 */
            color: #e0e0e0; /* 淺灰色字體 */
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* 主容器 */
        #container {
            background-color: rgba(29, 38, 64, 0.9); /* 半透明深藍色背景 */
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5); /* 更明顯的陰影 */
            width: 100%;
            max-width: 1200px; /* 調整為 1200px */
            box-sizing: border-box;
            margin-bottom: 30px;
            border: 1px solid rgba(60, 80, 120, 0.5); /* 細邊框 */
        }

        /* 標題 */
        h1, h2 {
            color: #92e6f0; /* 亮青藍色 */
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 0 10px rgba(146, 230, 240, 0.5);
        }
        h2 { font-size: 1.8em; }
        h1 { font-size: 2.5em; }

        /* 各區塊 */
        .section {
            margin-bottom: 35px;
            border-bottom: 1px solid rgba(60, 80, 120, 0.7); /* 區塊分隔線 */
            padding-bottom: 25px;
        }
        .section:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
        .section h3 {
            color: #c9e97f; /* 亮黃綠色 */
            margin-top: 0;
            margin-bottom: 20px;
            border-left: 6px solid #e1b400; /* 強調色黃色邊條 */
            padding-left: 15px;
            font-size: 1.5em;
        }

        /* 設定組 */
        .setting-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
            justify-content: center; /* 讓選項置中 */
        }
        .setting-group label {
            background-color: #2e3b5e; /* 深藍色背景 */
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            color: #d1d8e0; /* 淺色字體 */
            border: 1px solid #4a5d8b;
        }
        .setting-group label:hover {
            background-color: #3f4e7a;
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        .setting-group input[type="radio"] {
            margin-right: 10px;
            accent-color: #e1b400; /* 強調色黃色 */
            transform: scale(1.2); /* 放大單選鈕 */
        }

        /* 主要按鈕 */
        button {
            background-color: #00bcd4; /* 青藍色 */
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.4em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            display: block;
            margin: 30px auto 0;
            box-shadow: 0 5px 15px rgba(0, 188, 212, 0.4);
        }
        button:hover {
            background-color: #00a4b8;
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 188, 212, 0.6);
        }
        button:active {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 188, 212, 0.3);
        }

        /* 檔案選擇按鈕 */
        .action-button {
            background-color: #e1b400; /* 強調色黃色 */
            color: #333;
            margin-right: 15px;
            padding: 10px 20px;
            font-size: 1.1em;
            box-shadow: 0 3px 10px rgba(225, 180, 0, 0.3);
        }
        .action-button:hover {
            background-color: #c09e00;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(225, 180, 0, 0.5);
        }
        .action-button:active {
            transform: translateY(-1px);
        }

        /* 檔案列表 */
        ul {
            list-style-type: none;
            padding: 0;
            margin-top: 15px;
            max-height: 200px; /* 限制高度，可滾動 */
            overflow-y: auto;
            border: 1px solid rgba(60, 80, 120, 0.7);
            border-radius: 8px;
            background-color: #1a233b; /* 深色背景 */
        }
        ul li {
            background-color: #212c4c; /* 略淺的深色 */
            border-bottom: 1px solid rgba(60, 80, 120, 0.5);
            padding: 10px 15px;
            margin-bottom: 0;
            border-radius: 0;
            color: #c8d3f1; /* 淺藍色字體 */
        }
        ul li:first-child { border-top-left-radius: 8px; border-top-right-radius: 8px; }
        ul li:last-child { border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; border-bottom: none; }
        ul li:nth-child(even) { background-color: #1c2640; } /* 斑馬紋 */

        /* 全螢幕播放介面 */
        #fullscreen-view {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            /* background-color: black; */ /* 移除，改由 JS 判斷設置為黑色或白色 */
            overflow: hidden;
            z-index: 9999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            /* 預設背景色為黑色，在沒有圖片時或圖片載入前 */
            background-color: black; 
        }
        #fullscreen-view img {
            position: absolute;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain; /* 圖片保持比例，留白邊 */
            opacity: 0;
            transition: opacity 2s ease-in-out; /* 更慢的淡入淡出 */
        }
        #fullscreen-view img.active {
            opacity: 1;
        }
        /* 全螢幕播放時，播放控制條隱藏 */
        #controls {
            display: none; /* 預設隱藏控制條 */
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(10, 10, 20, 0.85); /* 更深的半透明背景 */
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1.2em;
            gap: 20px;
            color: #f0f0f0;
            border: 1px solid rgba(60, 80, 120, 0.5);
        }

        /* 說明文字 */
        .help-text {
            background-color: #2e3b5e; /* 深藍色背景 */
            border-left: 6px solid #00bcd4; /* 青藍色邊條 */
            margin: 25px 0;
            padding: 20px;
            border-radius: 8px;
            font-size: 1em;
            line-height: 1.8;
            color: #d1d8e0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        .help-text strong {
            color: #92e6f0; /* 亮青藍色強調 */
        }
        .folder-selection {
            align-items: flex-start; /* 讓按鈕和文字對齊 */
            flex-direction: column; /* 讓文字在按鈕下方 */
            gap: 8px;
        }
        .folder-selection .instruction {
            color: #a0a8b9; /* 較淡的提示文字 */
            font-size: 0.9em;
            margin-left: 5px; /* 稍微縮排 */
        }
    </style>
</head>
<body>

    <div id="container">
        <h1>音樂與圖片播放系統</h1>
		<div align="right">Vibe Coding by：<br/>文華國小資訊組長陳俊源<br/>v01-250909-1</div>
        <div class="help-text">
            <p><strong>設定說明：</strong></p>
            <p>1. 請點擊「選擇音樂資料夾」按鈕，以<strong>載入</strong>包含 MP3/WAV 音樂格式在內的<strong>"資料夾"</strong>。</p>
            <p>2. 請點擊「選擇圖片資料夾」按鈕，以<strong>載入</strong>包含 JPG/PNG 圖片格式在內的 <strong>"資料夾"</strong>。</p>
            <p>3. 選擇圖片輪播秒數和音樂播放模式。</p>
            <p>4. 點擊「開始播放」按鈕進入全螢幕模式。</p>
            <p>5. 在全螢幕模式下，按下 <strong>ESC 鍵</strong> 可停止播放並退出全螢幕。</p>
        </div>

        <div class="section">
            <h3>音樂列表 (共 <span id="musicCount">0</span> 首)</h3>
            <div class="folder-selection">
                <input type="file" id="musicFolderInput" webkitdirectory directory multiple style="display: none;">
                <button class="action-button" onclick="document.getElementById('musicFolderInput').click()">選擇音樂資料夾</button>
                <span class="instruction">請選擇您的 "音樂" 資料夾以載入音樂檔案(內含MP3/WAV檔案)。</span>
            </div>
            <ul id="musicList">
                <li>請點擊上方按鈕選擇音樂資料夾以載入檔案。</li>
            </ul>
        </div>

        <div class="section">
            <h3>圖片列表 (共 <span id="photoCount">0</span> 張)</h3>
            <div class="folder-selection">
                <input type="file" id="photoFolderInput" webkitdirectory directory multiple style="display: none;">
                <button class="action-button" onclick="document.getElementById('photoFolderInput').click()">選擇圖片資料夾</button>
                <span class="instruction">請選擇您的 "圖片" 資料夾以載入圖片檔案(內含JPG/PNG檔案)。</span>
            </div>
            <ul id="photoList">
                <li>請點擊上方按鈕選擇圖片資料夾以載入檔案。</li>
            </ul>
        </div>

        <div class="section">
            <h3>圖片輪播秒數設定 (每張)</h3>
            <div class="setting-group">
                <label><input type="radio" name="photoDuration" value="3" checked> 3 秒</label>
                <label><input type="radio" name="photoDuration" value="5"> 5 秒</label>
                <label><input type="radio" name="photoDuration" value="7"> 7 秒</label>
                <label><input type="radio" name="photoDuration" value="9"> 9 秒</label>
            </div>
        </div>

        <div class="section">
            <h3>音樂播放模式</h3>
            <div class="setting-group">
                <label><input type="radio" name="musicLoop" value="false" checked> 只播放 1 次</label>
                <label><input type="radio" name="musicLoop" value="true"> 一直重複播放</label>
            </div>
        </div>

        <button id="startButton">開始播放</button>
    </div>

    <div id="fullscreen-view">
        <!-- 播放控制條已移動到下方，並預設隱藏 -->
    </div>

    <audio id="audioPlayer" preload="auto"></audio>

    <script>
        const musicListElement = document.getElementById('musicList');
        const photoListElement = document.getElementById('photoList');
        const musicCountElement = document.getElementById('musicCount');
        const photoCountElement = document.getElementById('photoCount');
        const startButton = document.getElementById('startButton');
        const fullscreenView = document.getElementById('fullscreen-view');
        const audioPlayer = document.getElementById('audioPlayer');
        // 以下播放控制條相關元素已移除，因為不再顯示
        // const currentSongNameElement = document.getElementById('currentSongName');
        // const progressBar = document.getElementById('progressBar');
        // const currentTimeElement = document.getElementById('currentTime');
        // const durationElement = document.getElementById('duration');

        const musicFolderInput = document.getElementById('musicFolderInput');
        const photoFolderInput = document.getElementById('photoFolderInput');

        let musicFiles = []; // Stores File objects for music
        let photoFiles = []; // Stores File objects for photos
        let currentMusicIndex = 0;
        let currentPhotoIndex = 0;
        let photoIntervalId;
        let isPlaying = false;
        let musicLoopSetting = false; // true for loop, false for play once

        // Function to format time for display (不再使用，但保留以防萬一或將來擴展)
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // --- Handle File Selection ---
        musicFolderInput.addEventListener('change', (event) => {
            const files = event.target.files;
            musicFiles = Array.from(files).filter(file => {
                const name = file.name.toLowerCase();
                return name.endsWith('.mp3') || name.endsWith('.wav');
            });
            updateDisplayLists();
            event.target.value = null; // Important for allowing re-selection of the same folder
        });

        photoFolderInput.addEventListener('change', (event) => {
            const files = event.target.files;
            photoFiles = Array.from(files).filter(file => {
                const name = file.name.toLowerCase();
                return name.endsWith('.jpg') || name.endsWith('.png');
            });
            updateDisplayLists();
            event.target.value = null; // Important for allowing re-selection of the same folder
        });


        function updateDisplayLists() {
            musicListElement.innerHTML = '';
            if (musicFiles.length === 0) {
                musicListElement.innerHTML = '<li>請點擊上方按鈕選擇音樂資料夾以載入檔案。</li>';
            } else {
                musicFiles.forEach(file => {
                    const li = document.createElement('li');
                    li.textContent = file.name;
                    musicListElement.appendChild(li);
                });
            }
            musicCountElement.textContent = musicFiles.length;

            photoListElement.innerHTML = '';
            if (photoFiles.length === 0) {
                photoListElement.innerHTML = '<li>請點擊上方按鈕選擇圖片資料夾以載入檔案。</li>';
            } else {
                photoFiles.forEach(file => {
                    const li = document.createElement('li');
                    li.textContent = file.name;
                    photoListElement.appendChild(li);
                });
            }
            photoCountElement.textContent = photoFiles.length;
        }

        // --- Music Playback ---
        function playMusic() {
            if (musicFiles.length === 0) {
                console.warn("No music files to play.");
                return;
            }

            if (audioPlayer.src && audioPlayer.src.startsWith('blob:')) {
                URL.revokeObjectURL(audioPlayer.src);
            }

            const musicFile = musicFiles[currentMusicIndex];
            audioPlayer.src = URL.createObjectURL(musicFile); // Create URL from File object
            audioPlayer.play().catch(e => console.error("Error playing audio:", e));
        }

        audioPlayer.addEventListener('ended', () => {
            URL.revokeObjectURL(audioPlayer.src); // Clean up object URL after use
            currentMusicIndex++;
            if (currentMusicIndex < musicFiles.length) {
                playMusic();
            } else {
                if (musicLoopSetting) {
                    currentMusicIndex = 0; // Loop back to start
                    playMusic();
                } else {
                    stopPlayback(); // End if not looping
                }
            }
        });

        // timeupdate 和 loadedmetadata 事件監聽器已移除，因為不再顯示進度條

        // --- Photo Slideshow ---
        function startPhotoSlideshow(duration) {
            if (photoFiles.length === 0) {
                console.warn("No photo files to display.");
                // 如果沒有圖片，將背景設為白色
                fullscreenView.style.backgroundColor = 'white';
                return;
            }

            // 清除現有圖片和它們的 Object URL
            fullscreenView.querySelectorAll('img').forEach(img => {
                if (img.src && img.src.startsWith('blob:')) {
                    URL.revokeObjectURL(img.src);
                }
                img.remove();
            });


            const showNextPhoto = () => {
                const currentActiveImg = fullscreenView.querySelector('img.active');
                if (currentActiveImg) {
                    currentActiveImg.classList.remove('active');
                    // 在淡出過渡後撤銷前一個物件 URL
                    setTimeout(() => {
                        if (currentActiveImg.src && currentActiveImg.src.startsWith('blob:')) {
                            URL.revokeObjectURL(currentActiveImg.src);
                        }
                        currentActiveImg.remove(); // 在舊圖片淡出後移除
                    }, 2000); // 應該大於 transition duration
                }

                const photoFile = photoFiles[currentPhotoIndex];
                const img = document.createElement('img');
                img.src = URL.createObjectURL(photoFile); // 從 File 物件創建 URL
                img.alt = photoFile.name;
                fullscreenView.appendChild(img);

                // 等待圖片添加到 DOM 一小段時間後再淡入
                setTimeout(() => {
                    img.classList.add('active');
                }, 50);

                // 載入圖片後判斷尺寸，設定背景色
                img.onload = () => {
                    if (img.naturalWidth / img.naturalHeight !== window.innerWidth / window.innerHeight) {
                        fullscreenView.style.backgroundColor = 'white'; // 非等比例，背景設為白色
                    } else {
                        fullscreenView.style.backgroundColor = 'black'; // 等比例，背景設為黑色
                    }
                };
                img.onerror = () => {
                    console.error("Error loading image:", photoFile.name);
                    fullscreenView.style.backgroundColor = 'black'; // 載入失敗也設為黑色
                };


                currentPhotoIndex++;
                if (currentPhotoIndex >= photoFiles.length) {
                    currentPhotoIndex = 0; // 循環圖片
                }
            };

            showNextPhoto(); // 立即顯示第一張圖片

            photoIntervalId = setInterval(showNextPhoto, duration * 1000);
        }

        function stopPhotoSlideshow() {
            clearInterval(photoIntervalId);
            // 撤銷所有剩餘的圖片物件 URL 並移除圖片
            fullscreenView.querySelectorAll('img').forEach(img => {
                if (img.src && img.src.startsWith('blob:')) {
                    URL.revokeObjectURL(img.src);
                }
                img.remove();
            });
            // 停止後將全螢幕背景恢復為黑色 (預設)
            fullscreenView.style.backgroundColor = 'black';
        }

        // --- Fullscreen and Start/Stop Logic ---
        function enterFullscreen() {
            if (fullscreenView.requestFullscreen) {
                fullscreenView.requestFullscreen();
            } else if (fullscreenView.mozRequestFullScreen) { /* Firefox */
                fullscreenView.mozRequestFullScreen();
            } else if (fullscreenView.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
                fullscreenView.webkitRequestFullscreen();
            } else if (fullscreenView.msRequestFullscreen) { /* IE/Edge */
                fullscreenView.msRequestFullscreen();
            }
        }

        function exitFullscreen() {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.mozCancelFullScreen) { /* Firefox */
                document.mozCancelFullScreen();
            } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) { /* IE/Edge */
                document.msExitFullscreen();
            }
        }

              function startPlayback() {
            if (isPlaying) return;

            if (musicFiles.length === 0 && photoFiles.length === 0) {
                alert("請先選擇音樂或圖片資料夾，確保至少有檔案可播放！");
                return;
            }

            // Get settings
            const selectedPhotoDuration = document.querySelector('input[name="photoDuration"]:checked').value;
            musicLoopSetting = document.querySelector('input[name="musicLoop"]:checked').value === 'true';

            isPlaying = true;
            fullscreenView.style.display = 'flex';
            enterFullscreen();

            currentMusicIndex = 0;
            currentPhotoIndex = 0;

            if (musicFiles.length > 0) {
                playMusic();
                // 這裡移除了 audioPlayer.loop = musicLoopSetting;
            } else {
                console.warn("No music files selected. Only playing slideshow.");
            }

            if (photoFiles.length > 0) {
                startPhotoSlideshow(parseInt(selectedPhotoDuration));
            } else {
                 console.warn("No photo files selected. Displaying white background in fullscreen.");
                 // 如果沒有圖片，直接將全螢幕背景設定為白色
                 fullscreenView.style.backgroundColor = 'white';
            }
        }

        function stopPlayback() {
            if (!isPlaying) return;

            isPlaying = false;
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            if (audioPlayer.src && audioPlayer.src.startsWith('blob:')) {
                URL.revokeObjectURL(audioPlayer.src); // Clean up music object URL
            }

            stopPhotoSlideshow();
            fullscreenView.style.display = 'none';
            exitFullscreen();
        }

        // Handle Fullscreen exit event (ESC key or browser UI)
        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement && !document.webkitIsFullScreen && !document.mozFullScreen && !document.msFullscreenElement) {
                // User exited fullscreen manually, stop playback
                stopPlayback();
            }
        });

        // --- Initialization ---
        startButton.addEventListener('click', startPlayback);
        updateDisplayLists(); // Initialize empty lists
    </script>

</body>
</html>